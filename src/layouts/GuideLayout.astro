---
import BaseLayout from './BaseLayout.astro';
import { Navigation } from '../components/Navigation';
import Footer from '../components/Footer.astro';
import StickyCTA from '../components/StickyCTA.astro';
import { ScrollAnimation } from '../components/ScrollAnimation';
import { Button } from '../components/ui/button';
import '../styles/globals.css';

export interface Props {
  title: string;
  description: string;
  category?: string;
  readTime?: string;
  lastUpdated?: string;
  author?: string;
}

const { 
  title, 
  description, 
  category = 'Guide',
  readTime = '5 min read',
  lastUpdated,
  author = 'DrySpace Experts'
} = Astro.props;

const breadcrumbs = [
  { name: 'Home', href: '/' },
  { name: 'Guides', href: '/guides' },
  { name: category, href: '#' }
];
---

<BaseLayout title={title} description={description}>
  <Navigation client:load />
  
  <!-- Hero Section -->
  <section class="relative bg-gradient-to-br from-blue-50 to-white pt-24 pb-12 lg:pt-32 lg:pb-16">
    <div class="absolute inset-0 opacity-5" 
         style="background-image: radial-gradient(circle at 1px 1px, blue 1px, transparent 1px); background-size: 40px 40px;">
    </div>
    
    <div class="relative max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
      <!-- Breadcrumbs -->
      <nav class="mb-8">
        <ol class="flex items-center space-x-2 text-sm">
          {breadcrumbs.map((item, index) => (
            <li class="flex items-center">
              {index > 0 && (
                <svg class="w-4 h-4 mx-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
              )}
              {index < breadcrumbs.length - 1 ? (
                <a href={item.href} class="text-gray-600 hover:text-primary transition-colors">
                  {item.name}
                </a>
              ) : (
                <span class="text-gray-900 font-medium">{item.name}</span>
              )}
            </li>
          ))}
        </ol>
      </nav>
      
      <ScrollAnimation animation="fadeUp" client:visible>
        <div class="text-center">
          <div class="flex items-center justify-center gap-3 mb-6">
            <span class="bg-blue-100 text-blue-800 px-4 py-2 rounded-full text-sm font-medium">
              {category}
            </span>
            <span class="text-gray-500">â€¢</span>
            <span class="text-gray-600 text-sm">{readTime}</span>
          </div>
          
          <h1 class="text-4xl sm:text-5xl lg:text-6xl font-bold text-gray-900 mb-6">
            {title}
          </h1>
          
          <p class="text-xl text-gray-600 mb-8 max-w-3xl mx-auto">
            {description}
          </p>
          
          <div class="flex items-center justify-center gap-6 text-sm text-gray-600">
            <div class="flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
              </svg>
              <span>{author}</span>
            </div>
            {lastUpdated && (
              <div class="flex items-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span>Updated: {lastUpdated}</span>
              </div>
            )}
          </div>
        </div>
      </ScrollAnimation>
    </div>
  </section>
  
  <!-- Table of Contents -->
  <section class="py-8 border-b">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="bg-gray-50 rounded-lg p-6">
        <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
          </svg>
          Table of Contents
        </h2>
        <div id="toc" class="space-y-2 text-sm">
          <!-- TOC will be populated by JavaScript -->
        </div>
      </div>
    </div>
  </section>
  
  <!-- Main Content -->
  <section class="py-12 lg:py-20">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="grid lg:grid-cols-4 gap-12">
        <!-- Article Content -->
        <article class="lg:col-span-3 prose prose-lg max-w-none" id="guide-content">
          <slot />
        </article>
        
        <!-- Sidebar -->
        <aside class="lg:col-span-1">
          <div class="sticky top-24 space-y-8">
            <!-- Quick Actions -->
            <div class="bg-primary/5 border border-primary/20 rounded-lg p-6">
              <h3 class="text-lg font-bold text-gray-900 mb-3">
                Need Help?
              </h3>
              <p class="text-sm text-gray-600 mb-4">
                Get expert assistance with your waterproofing needs.
              </p>
              <Button class="w-full mb-3" size="sm">
                Get Free Quote
              </Button>
              <a href="tel:4375450067" class="text-primary font-semibold text-sm hover:underline block text-center">
                ðŸ“ž (437) 545-0067
              </a>
            </div>
            
            <!-- Related Guides -->
            <div>
              <h3 class="text-lg font-semibold text-gray-900 mb-4">
                Related Guides
              </h3>
              <ul class="space-y-3 text-sm">
                <li>
                  <a href="/guides/foundation-problems" class="text-primary hover:underline">
                    Identifying Foundation Problems
                  </a>
                </li>
                <li>
                  <a href="/guides/waterproofing-methods" class="text-primary hover:underline">
                    Waterproofing Methods Compared
                  </a>
                </li>
                <li>
                  <a href="/guides/maintenance-tips" class="text-primary hover:underline">
                    Seasonal Maintenance Guide
                  </a>
                </li>
              </ul>
            </div>
            
            <!-- Download PDF -->
            <div class="bg-gray-50 rounded-lg p-6 text-center">
              <svg class="w-8 h-8 mx-auto mb-3 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
              </svg>
              <p class="text-sm font-semibold mb-2">Save for Later</p>
              <button class="text-primary text-sm hover:underline">
                Download PDF Guide
              </button>
            </div>
          </div>
        </aside>
      </div>
    </div>
  </section>
  
  <!-- Next Steps -->
  <section class="bg-gray-50 py-16 lg:py-24">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <ScrollAnimation animation="fadeUp" client:visible>
        <h2 class="text-3xl font-bold text-gray-900 mb-6">
          Ready to Protect Your Home?
        </h2>
        <p class="text-xl text-gray-600 mb-8">
          Don't wait for water damage to worsen. Get professional help today.
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <Button size="lg" class="text-lg px-8">
            Schedule Free Assessment
          </Button>
          <Button size="lg" variant="outline" class="text-lg px-8">
            Download Our Checklist
          </Button>
        </div>
      </ScrollAnimation>
    </div>
  </section>
  
  <Footer />
  <StickyCTA />
</BaseLayout>

<style>
  /* Enhanced prose styling for guides */
  .prose h2 {
    @apply text-3xl font-bold text-gray-900 mt-12 mb-6 scroll-mt-24;
  }
  
  .prose h3 {
    @apply text-2xl font-semibold text-gray-900 mt-8 mb-4 scroll-mt-24;
  }
  
  .prose h4 {
    @apply text-xl font-semibold text-gray-900 mt-6 mb-3 scroll-mt-24;
  }
  
  .prose ul {
    @apply my-6 space-y-2;
  }
  
  .prose ol {
    @apply my-6 space-y-2;
  }
  
  .prose li {
    @apply text-gray-700;
  }
  
  .prose blockquote {
    @apply border-l-4 border-blue-500 pl-6 italic my-8 text-gray-700;
  }
  
  .prose table {
    @apply w-full my-8 border-collapse shadow-sm rounded-lg overflow-hidden;
  }
  
  .prose th {
    @apply bg-gray-100 p-4 text-left font-semibold border-b border-gray-300;
  }
  
  .prose td {
    @apply p-4 border-b border-gray-200;
  }
  
  .prose tr:last-child td {
    @apply border-b-0;
  }
  
  /* Custom styles for guide-specific elements */
  .prose .tip {
    @apply bg-blue-50 border-l-4 border-blue-500 p-6 my-8;
  }
  
  .prose .warning {
    @apply bg-yellow-50 border-l-4 border-yellow-500 p-6 my-8;
  }
  
  .prose .danger {
    @apply bg-red-50 border-l-4 border-red-500 p-6 my-8;
  }
</style>

<script>
  // Generate table of contents
  document.addEventListener('DOMContentLoaded', () => {
    const content = document.getElementById('guide-content');
    const toc = document.getElementById('toc');
    
    if (content && toc) {
      const headings = content.querySelectorAll('h2, h3');
      const tocHTML = Array.from(headings).map((heading) => {
        const id = heading.textContent?.toLowerCase().replace(/\s+/g, '-') || '';
        heading.id = id;
        
        const level = heading.tagName === 'H2' ? 0 : 1;
        const paddingClass = level === 0 ? '' : 'pl-4';
        
        return `
          <a href="#${id}" class="block py-1 ${paddingClass} text-gray-600 hover:text-primary transition-colors">
            ${heading.textContent}
          </a>
        `;
      }).join('');
      
      toc.innerHTML = tocHTML;
    }
  });
</script>