---
export interface Props {
  title?: string;
  videoId?: string;
  videoUrl?: string;
  platform?: 'youtube' | 'vimeo' | 'custom';
  aspectRatio?: '16:9' | '4:3' | '1:1';
  description?: string;
  caption?: string;
  class?: string;
}

const { 
  title,
  videoId,
  videoUrl,
  platform = 'youtube',
  aspectRatio = '16:9',
  description,
  caption,
  class: className = ''
} = Astro.props;

const aspectClasses = {
  '16:9': 'pb-[56.25%]',
  '4:3': 'pb-[75%]',
  '1:1': 'pb-[100%]'
};

const embedUrl = platform === 'youtube' && videoId 
  ? `https://www.youtube.com/embed/${videoId}`
  : platform === 'vimeo' && videoId
  ? `https://player.vimeo.com/video/${videoId}`
  : videoUrl;
---

<div class={`video-container max-w-4xl mx-auto my-8 ${className}`}>
  {title && (
    <h3 class="text-2xl font-bold text-center mb-4">{title}</h3>
  )}
  
  <div class={`relative ${aspectClasses[aspectRatio]} h-0 overflow-hidden rounded-lg shadow-lg bg-black`}>
    <iframe 
      class="absolute top-0 left-0 w-full h-full"
      src={embedUrl}
      title={title || 'Video'}
      frameborder="0" 
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
      allowfullscreen
      loading="lazy"
    ></iframe>
  </div>
  
  {(description || caption) && (
    <div class="mt-4 p-5 bg-muted/50 rounded-lg">
      {description && (
        <div class="space-y-2 text-muted-foreground">
          <p>{description}</p>
        </div>
      )}
      {caption && (
        <p class="text-sm text-muted-foreground italic mt-2">{caption}</p>
      )}
    </div>
  )}
</div>

{platform === 'youtube' && videoId && (
  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "VideoObject",
    "name": title || "Video",
    "description": description || title || "Video content",
    "thumbnailUrl": `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`,
    "uploadDate": new Date().toISOString(),
    "contentUrl": `https://www.youtube.com/watch?v=${videoId}`,
    "embedUrl": `https://www.youtube.com/embed/${videoId}`
  })} />
)}