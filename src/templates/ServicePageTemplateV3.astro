---
import MainLayout from '../layouts/MainLayout.astro';
import Hero from '../components/ui/Hero.astro';
import Section from '../components/ui/Section.astro';
import Grid from '../components/ui/Grid.astro';
import AstroCard from '../components/ui/AstroCard.astro';
import AstroButton from '../components/ui/AstroButton.astro';
import AstroBadge from '../components/ui/AstroBadge.astro';
import ContentCard from '../components/ui/ContentCard.astro';
import FAQAccordion from '../components/FAQAccordion';
import { 
  CheckCircle, 
  Shield, 
  Clock, 
  Award,
  Phone,
  ArrowRight,
  Wrench,
  AlertCircle,
  DollarSign
} from 'lucide-react';

export interface Props {
  // Basic Service Info
  serviceName: string;
  serviceTitle: string;
  serviceSubtitle: string;
  serviceDescription: string;
  
  // Hero
  heroBadge?: string;
  heroImage?: string;
  heroFeatures?: string[];
  
  // Pricing
  startingPrice?: string;
  priceRange?: string;
  
  // Service Details
  processSteps?: Array<{
    title: string;
    description: string;
    icon?: string;
  }>;
  
  benefits?: Array<{
    title: string;
    description: string;
  }>;
  
  // Related Content
  relatedServices?: Array<{
    title: string;
    url: string;
    description: string;
    image?: string;
  }>;
  
  // FAQs
  serviceFaqs?: Array<{
    question: string;
    answer: string;
  }>;
  
  // Main content
  mainContent?: string;
}

const {
  serviceName,
  serviceTitle,
  serviceSubtitle,
  serviceDescription,
  heroBadge,
  heroImage,
  heroFeatures = [],
  startingPrice,
  priceRange,
  processSteps = [],
  benefits = [],
  relatedServices = [],
  serviceFaqs = [],
  mainContent
} = Astro.props;

// Default process steps if none provided
const defaultSteps = [
  {
    title: "Free Inspection",
    description: "Our experts assess your property and identify issues",
    icon: "search"
  },
  {
    title: "Custom Solution",
    description: "We design a tailored solution for your specific needs",
    icon: "lightbulb"
  },
  {
    title: "Professional Installation",
    description: "Our certified team implements the solution efficiently",
    icon: "wrench"
  },
  {
    title: "Lifetime Warranty",
    description: "Enjoy peace of mind with our comprehensive warranty",
    icon: "shield"
  }
];

const steps = processSteps.length > 0 ? processSteps : defaultSteps;
---

<MainLayout title={serviceTitle} description={serviceDescription}>
  <!-- Hero Section -->
  <Hero
    title={serviceName}
    subtitle={serviceSubtitle}
    description={serviceDescription}
    badge={heroBadge || "Professional Service"}
    image={heroImage}
    imageAlt={`${serviceName} service in Toronto`}
    features={heroFeatures}
    primaryCTA={{ text: "Get Free Quote", href: "/contact/" }}
    secondaryCTA={{ text: "Call Now", href: "tel:437-545-0067" }}
  />
  
  <!-- Trust Signals -->
  <Section spacing="small" background="muted">
    <Grid columns={4} gap="small">
      <div class="text-center">
        <Shield className="h-8 w-8 text-primary mx-auto mb-2" client:load />
        <p class="font-semibold">Licensed & Insured</p>
      </div>
      <div class="text-center">
        <Award className="h-8 w-8 text-primary mx-auto mb-2" client:load />
        <p class="font-semibold">25+ Years Experience</p>
      </div>
      <div class="text-center">
        <Clock className="h-8 w-8 text-primary mx-auto mb-2" client:load />
        <p class="font-semibold">Same Day Service</p>
      </div>
      <div class="text-center">
        <CheckCircle className="h-8 w-8 text-primary mx-auto mb-2" client:load />
        <p class="font-semibold">Lifetime Warranty</p>
      </div>
    </Grid>
  </Section>
  
  <!-- Main Content -->
  <Section background="white" className="py-16">
    <div class="max-w-4xl mx-auto">
      <div class="prose prose-lg max-w-none
        prose-headings:font-bold prose-headings:text-foreground
        prose-h2:text-3xl prose-h2:mt-12 prose-h2:mb-6 prose-h2:border-b prose-h2:border-border prose-h2:pb-4
        prose-h3:text-xl prose-h3:mt-8 prose-h3:mb-4 prose-h3:text-primary
        prose-p:text-foreground prose-p:leading-relaxed prose-p:mb-6
        prose-a:text-primary prose-a:underline-offset-4 hover:prose-a:underline
        prose-strong:text-foreground prose-strong:font-semibold
        prose-ul:list-disc prose-ul:pl-6 prose-ul:my-6 prose-ul:space-y-2
        prose-ol:list-decimal prose-ol:pl-6 prose-ol:my-6 prose-ol:space-y-2
        prose-li:text-foreground prose-li:leading-relaxed
        prose-img:rounded-lg prose-img:shadow-lg prose-img:my-8
        prose-hr:border-border prose-hr:my-12
        prose-blockquote:border-l-4 prose-blockquote:border-primary prose-blockquote:pl-6 prose-blockquote:italic
        [&>h2]:first-of-type:mt-0
      ">
        <slot name="mainContent" />
      </div>
    </div>
  </Section>
  
  <!-- Process Steps -->
  <Section 
    title="Our Process" 
    subtitle="We follow a proven approach to ensure the best results"
    background="muted"
    centered
  >
    <Grid columns={4}>
      {steps.map((step, index) => (
        <div class="text-center space-y-4">
          <div class="relative">
            <div class="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto">
              <Wrench className="h-8 w-8 text-primary" client:load />
            </div>
            <span class="absolute -top-2 -right-2 w-8 h-8 bg-primary text-white rounded-full flex items-center justify-center text-sm font-bold">
              {index + 1}
            </span>
          </div>
          <h3 class="text-lg font-semibold">{step.title}</h3>
          <p class="text-muted-foreground text-sm">{step.description}</p>
        </div>
      ))}
    </Grid>
  </Section>
  
  <!-- Benefits -->
  {benefits.length > 0 && (
    <Section
      title="Why Choose Our Service"
      subtitle="Experience the difference with our professional approach"
    >
      <Grid columns={3}>
        {benefits.map(benefit => (
          <AstroCard>
            <div class="flex gap-4">
              <CheckCircle className="h-6 w-6 text-secondary flex-shrink-0 mt-1" client:load />
              <div>
                <h3 class="font-semibold mb-2">{benefit.title}</h3>
                <p class="text-muted-foreground text-sm">{benefit.description}</p>
              </div>
            </div>
          </AstroCard>
        ))}
      </Grid>
    </Section>
  )}
  
  <!-- Pricing CTA -->
  {(startingPrice || priceRange) && (
    <Section background="primary" spacing="small">
      <div class="text-center space-y-6">
        <div>
          <h2 class="text-3xl font-bold text-white mb-2">Transparent Pricing</h2>
          <p class="text-white/90">No hidden fees - Get your free quote today</p>
        </div>
        
        <div class="flex justify-center gap-8">
          {startingPrice && (
            <div class="text-white">
              <p class="text-sm opacity-75">Starting from</p>
              <p class="text-3xl font-bold">{startingPrice}</p>
            </div>
          )}
          {priceRange && (
            <div class="text-white">
              <p class="text-sm opacity-75">Price range</p>
              <p class="text-3xl font-bold">{priceRange}</p>
            </div>
          )}
        </div>
        
        <div class="flex justify-center gap-4">
          <AstroButton 
            href="/contact/" 
            variant="secondary" 
            size="lg"
            class="bg-white text-primary hover:bg-gray-100"
          >
            Get Free Quote
          </AstroButton>
          <AstroButton 
            href="tel:437-545-0067" 
            variant="outline" 
            size="lg"
            class="border-white text-white hover:bg-white/10"
          >
            <Phone className="h-5 w-5" client:load />
            Call Now
          </AstroButton>
        </div>
      </div>
    </Section>
  )}
  
  <!-- FAQs -->
  {serviceFaqs.length > 0 && (
    <Section
      title="Frequently Asked Questions"
      subtitle="Get answers to common questions about our service"
      background="muted"
    >
      <div class="max-w-3xl mx-auto">
        <FAQAccordion faqs={serviceFaqs} client:load />
      </div>
    </Section>
  )}
  
  <!-- Related Services -->
  {relatedServices.length > 0 && (
    <Section
      title="Related Services"
      subtitle="Explore our other professional waterproofing solutions"
    >
      <Grid columns={3}>
        {relatedServices.map(service => (
          <ContentCard
            title={service.title}
            description={service.description}
            href={service.url}
            image={service.image}
            type="service"
          />
        ))}
      </Grid>
    </Section>
  )}
  
  <!-- Final CTA -->
  <Section background="secondary" spacing="large">
    <div class="text-center space-y-6">
      <h2 class="text-4xl font-bold text-white">
        Ready to Protect Your Property?
      </h2>
      <p class="text-xl text-white/90 max-w-2xl mx-auto">
        Don't wait until it's too late. Get professional waterproofing solutions today.
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <AstroButton 
          href="/contact/" 
          size="lg"
          class="bg-white text-secondary hover:bg-gray-100 gap-2"
        >
          Schedule Free Inspection
          <ArrowRight className="h-5 w-5" client:load />
        </AstroButton>
        <AstroButton 
          href="tel:437-545-0067" 
          variant="outline" 
          size="lg"
          class="border-white text-white hover:bg-white/10 gap-2"
        >
          <Phone className="h-5 w-5" client:load />
          (437) 545-0067
        </AstroButton>
      </div>
      
      <div class="flex items-center justify-center gap-2 text-white/75 text-sm">
        <AlertCircle className="h-4 w-4" client:load />
        <span>Emergency service available 24/7</span>
      </div>
    </div>
  </Section>
</MainLayout>

<style>
  /* Enhanced styling for markdown content sections */
  .prose h2 {
    position: relative;
    padding-left: 1rem;
  }
  
  .prose h2::before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 4px;
    height: 24px;
    background-color: hsl(var(--primary));
    border-radius: 2px;
  }
  
  /* Create visual sections with alternating backgrounds */
  .prose > h2 {
    margin-top: 4rem;
    padding-top: 2rem;
  }
  
  /* Style for better section separation */
  .prose > h3 {
    font-weight: 600;
    color: hsl(var(--foreground));
    margin-top: 2rem;
  }
  
  /* Enhanced list styling */
  .prose ul li::marker {
    color: hsl(var(--primary));
  }
  
  .prose ol li::marker {
    color: hsl(var(--primary));
    font-weight: 600;
  }
  
  /* Card-like sections for certain content */
  .prose blockquote {
    background-color: hsl(var(--muted));
    padding: 1.5rem;
    border-radius: 0.5rem;
    margin: 2rem 0;
  }
</style>