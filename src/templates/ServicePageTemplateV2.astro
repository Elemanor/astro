---
// Service Page Template V2 - With sticky TOC on right side
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import WhyChooseUs from '../components/WhyChooseUs.astro';
import ReviewsSection from '../components/ReviewsSection.astro';
import EmergencyCTA from '../components/EmergencyCTA.astro';
import TrustSignals from '../components/TrustSignals.astro';

export interface Props {
  // Basic Service Info
  serviceName: string;
  serviceTitle: string;
  serviceSubtitle: string;
  serviceDescription: string;
  
  // Pricing
  startingPrice?: string;
  priceRange?: string;
  
  // Hero Stats (optional - will use defaults if not provided)
  heroStats?: Array<{
    value: string;
    label: string;
  }>;
  
  // Related Services
  relatedServices?: Array<{
    title: string;
    url: string;
    description: string;
    image: string;
  }>;
  
  // FAQs
  serviceFaqs?: Array<{
    question: string;
    answer: string;
  }>;
  
  // Content Sections for TOC
  tableOfContents?: Array<{
    label: string;
    href: string;
  }>;
  
  // Main content (HTML string or slots)
  mainContent?: string;
  
  // Optional customizations
  showEmergencyCTA?: boolean;
  showWhyChooseUs?: boolean;
  showReviews?: boolean;
  showTrustSignals?: boolean;
  customCTAText?: string;
  customCTALink?: string;
}

const {
  serviceName,
  serviceTitle,
  serviceSubtitle,
  serviceDescription,
  startingPrice,
  priceRange,
  heroStats = [
    { value: "25+", label: "Years Experience" },
    { value: "5,000+", label: "Projects Completed" },
    { value: "100%", label: "Satisfaction Rate" },
    { value: "Lifetime", label: "Warranty" }
  ],
  relatedServices = [],
  serviceFaqs = [],
  tableOfContents = [],
  mainContent = "",
  showEmergencyCTA = true,
  showWhyChooseUs = true,
  showReviews = true,
  showTrustSignals = true,
  customCTAText = "Get Free Quote",
  customCTALink = "/quote"
} = Astro.props;
---

<BaseLayout title={`${serviceName} Toronto | Professional Service | DrySpace`} description={serviceDescription}>
  <Header />
  
  <!-- Breadcrumb Navigation -->
  <nav class="breadcrumb" aria-label="Breadcrumb">
    <div class="container">
      <ul>
        <li><a href="/">Home</a></li>
        <li><a href="/services/">Services</a></li>
        <li aria-current="page">{serviceName}</li>
      </ul>
    </div>
  </nav>
  
  <!-- Service Hero Section -->
  <section class="service-hero">
    <div class="hero-container">
      <div class="hero-content">
        <h1 class="hero-title">{serviceTitle}</h1>
        <p class="hero-subtitle">{serviceSubtitle}</p>
        <p class="hero-description">{serviceDescription}</p>
        
        <div class="hero-stats">
          {heroStats.map((stat) => (
            <div class="stat-card">
              <span class="stat-value">{stat.value}</span>
              <span class="stat-label">{stat.label}</span>
            </div>
          ))}
        </div>
        
        <div class="hero-cta">
          <a href={customCTALink} class="btn btn-primary">{customCTAText}</a>
          <a href="tel:4375450067" class="btn btn-outline">üìû (437) 545-0067</a>
        </div>
        
        <div class="trust-badges">
          <span class="badge">‚úì Free Assessment</span>
          <span class="badge">‚úì Licensed & Insured</span>
          <span class="badge">‚úì Same Day Service</span>
          <span class="badge">‚úì 24/7 Emergency</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Service Details Section with 3-column layout -->
  <section class="service-details">
    <div class="container">
      <div class="content-grid-three-column">
        <!-- Left Sidebar -->
        <aside class="sidebar-left">
          <div class="sticky-sidebar">
            <div class="quote-form">
              <h3>Get Your Free Quote</h3>
              <p>Professional assessment with no obligation</p>
              <a href="/quote/" class="btn btn-primary w-full">Request Quote</a>
            </div>
            
            <div class="emergency-box">
              <h3>‚ö†Ô∏è Emergency Service</h3>
              <p>Water damage? Foundation issues? We're here 24/7</p>
              <a href="tel:4375450067" class="btn btn-destructive w-full">Call Emergency Line</a>
            </div>

            {(startingPrice || priceRange) && (
              <div class="price-box">
                <h3>Investment Range</h3>
                {priceRange && <p class="price-range">{priceRange}</p>}
                {startingPrice && !priceRange && <p class="price-range">Starting at {startingPrice}</p>}
                <ul class="price-factors">
                  <li>Free inspection & quote</li>
                  <li>Transparent pricing</li>
                  <li>Lifetime warranty</li>
                  <li>Financing available</li>
                </ul>
                <p class="financing">0% Financing Available</p>
              </div>
            )}

            <div class="trust-indicators">
              <h3>Why Trust DrySpace?</h3>
              <ul>
                <li>‚úì Licensed & Insured</li>
                <li>‚úì 25+ Years Experience</li>
                <li>‚úì Lifetime Warranty</li>
                <li>‚úì 24/7 Emergency Service</li>
                <li>‚úì Free Inspections</li>
                <li>‚úì BBB A+ Rating</li>
              </ul>
            </div>
          </div>
        </aside>

        <!-- Main Content -->
        <div class="main-content">
          <!-- Slot for custom content or use mainContent prop -->
          <slot name="content">
            {mainContent && <Fragment set:html={mainContent} />}
          </slot>
        </div>

        <!-- Right Sidebar - Table of Contents -->
        {tableOfContents.length > 0 && (
          <aside class="sidebar-right">
            <div class="sticky-toc">
              <nav class="toc-nav" aria-label="Table of contents">
                <h3>Quick Navigation</h3>
                <ul class="toc-list">
                  {tableOfContents.map((item) => (
                    <li>
                      <a href={item.href} class="toc-link">{item.label}</a>
                    </li>
                  ))}
                </ul>
              </nav>
            </div>
          </aside>
        )}
      </div>
    </div>
  </section>

  <!-- FAQ Section (if FAQs provided) -->
  {serviceFaqs.length > 0 && (
    <section class="service-faq">
      <div class="container">
        <h2>Frequently Asked Questions</h2>
        <div class="faq-grid">
          {serviceFaqs.map((faq, index) => (
            <div class="faq-item">
              <h3><span class="faq-number">{index + 1}.</span> {faq.question}</h3>
              <p>{faq.answer}</p>
            </div>
          ))}
        </div>
        <div class="more-questions">
          <p>Have more questions? Our experts are ready to help!</p>
          <a href="tel:4375450067" class="btn btn-primary">Call (437) 545-0067</a>
        </div>
      </div>
    </section>
  )}

  <!-- Related Services (if provided) -->
  {relatedServices.length > 0 && (
    <section class="related-services">
      <div class="container">
        <h2>Related Services</h2>
        <p class="section-intro">Explore our other professional waterproofing and foundation services:</p>
        <div class="services-grid">
          {relatedServices.map((service) => (
            <div class="service-card">
              <img src={service.image} alt={service.title} />
              <h3>{service.title}</h3>
              <p>{service.description}</p>
              <a href={service.url} class="service-link">Learn More ‚Üí</a>
            </div>
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- Optional Sections -->
  {showWhyChooseUs && <WhyChooseUs />}
  {showReviews && <ReviewsSection />}
  {showTrustSignals && <TrustSignals />}
  {showEmergencyCTA && <EmergencyCTA />}

  <Footer />
</BaseLayout>

<style>
  /* Global Container */
  .container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 1rem;
  }

  /* Breadcrumb */
  .breadcrumb {
    background: #f7fafc;
    padding: 1rem 0;
    border-bottom: 1px solid #e2e8f0;
  }
  
  .breadcrumb ul {
    display: flex;
    list-style: none;
    padding: 0;
    margin: 0;
    font-size: 0.875rem;
  }
  
  .breadcrumb li:not(:last-child)::after {
    content: '/';
    margin: 0 0.5rem;
    color: #cbd5e0;
  }
  
  .breadcrumb a {
    color: #4a5568;
    text-decoration: none;
  }
  
  .breadcrumb a:hover {
    color: #f97316;
  }

  /* Hero Section */
  .service-hero {
    background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
    padding: 6rem 0 4rem;
    position: relative;
    overflow: hidden;
  }

  .hero-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1rem;
  }

  .hero-content {
    max-width: 800px;
  }

  .hero-title {
    font-size: 3rem;
    font-weight: 700;
    color: white;
    margin-bottom: 1rem;
    line-height: 1.2;
  }

  .hero-subtitle {
    font-size: 1.5rem;
    color: #f97316;
    margin-bottom: 1rem;
  }

  .hero-description {
    font-size: 1.25rem;
    color: rgba(255, 255, 255, 0.9);
    margin-bottom: 2rem;
    line-height: 1.6;
  }

  .hero-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
  }

  .stat-card {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    padding: 1.5rem;
    border-radius: 0.5rem;
    text-align: center;
  }

  .stat-value {
    display: block;
    font-size: 2rem;
    font-weight: 700;
    color: #f97316;
    margin-bottom: 0.25rem;
  }

  .stat-label {
    display: block;
    font-size: 0.875rem;
    color: rgba(255, 255, 255, 0.8);
    text-transform: uppercase;
  }

  .hero-cta {
    display: flex;
    gap: 1rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
  }

  .trust-badges {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .badge {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.3);
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 0.25rem;
    font-size: 0.875rem;
  }

  /* Three Column Layout */
  .service-details {
    padding: 4rem 0;
    background: #fff;
  }

  .content-grid-three-column {
    display: grid;
    grid-template-columns: 1fr;
    gap: 3rem;
  }

  @media (min-width: 1024px) {
    .content-grid-three-column {
      grid-template-columns: 280px 1fr;
    }
  }

  @media (min-width: 1280px) {
    .content-grid-three-column {
      grid-template-columns: 280px 1fr 260px;
    }
  }

  /* Main Content Typography */
  .main-content :global(h2) {
    font-size: 2rem;
    font-weight: 700;
    margin: 2.5rem 0 1rem;
    color: #1a202c;
    scroll-margin-top: 5rem;
  }
  
  .main-content :global(h3) {
    font-size: 1.5rem;
    font-weight: 600;
    margin: 2rem 0 1rem;
    color: #1a202c;
    scroll-margin-top: 5rem;
  }

  .main-content :global(h4) {
    font-size: 1.25rem;
    font-weight: 600;
    margin: 1.5rem 0 0.75rem;
    color: #1a202c;
  }

  .main-content :global(p) {
    color: #4a5568;
    line-height: 1.7;
    margin-bottom: 1rem;
  }

  .main-content :global(ul) {
    margin: 1rem 0;
    padding-left: 1.5rem;
  }

  .main-content :global(li) {
    margin-bottom: 0.75rem;
    color: #4a5568;
    line-height: 1.6;
  }

  .main-content :global(strong) {
    color: #1a202c;
    font-weight: 600;
  }

  /* Left Sidebar */
  .sidebar-left {
    order: -1;
  }

  .sticky-sidebar {
    position: sticky;
    top: 2rem;
  }

  .quote-form,
  .emergency-box,
  .price-box,
  .trust-indicators {
    background: #f7fafc;
    padding: 1.5rem;
    border-radius: 0.5rem;
    margin-bottom: 1.5rem;
  }

  .emergency-box {
    background: #fef2f2;
    border: 1px solid #fecaca;
  }

  .price-box {
    background: #fff;
    border: 2px solid #f97316;
  }

  .quote-form h3,
  .emergency-box h3,
  .price-box h3,
  .trust-indicators h3 {
    font-size: 1.25rem;
    margin-bottom: 0.75rem;
    color: #1a202c;
  }

  .quote-form p,
  .emergency-box p {
    color: #4a5568;
    margin-bottom: 1rem;
    font-size: 0.875rem;
  }

  .price-range {
    font-size: 1.875rem;
    font-weight: 700;
    color: #f97316;
    margin-bottom: 1rem;
    display: block;
  }

  .price-factors {
    list-style: none;
    padding: 0;
    margin: 1rem 0;
    font-size: 0.875rem;
  }

  .price-factors li {
    padding: 0.5rem 0;
    border-bottom: 1px solid #e2e8f0;
    color: #4a5568;
  }

  .financing {
    text-align: center;
    font-weight: 600;
    color: #10b981;
    margin-top: 1rem;
  }

  .trust-indicators ul {
    list-style: none;
    padding: 0;
  }

  .trust-indicators li {
    padding: 0.5rem 0;
    color: #4a5568;
    font-size: 0.875rem;
  }

  /* Right Sidebar - TOC */
  .sidebar-right {
    display: none;
  }

  @media (min-width: 1280px) {
    .sidebar-right {
      display: block;
    }
  }

  .sticky-toc {
    position: sticky;
    top: 2rem;
    max-height: calc(100vh - 4rem);
    overflow-y: auto;
  }

  .toc-nav {
    background: #f7fafc;
    border-left: 3px solid #f97316;
    padding: 1.5rem;
    border-radius: 0.5rem;
  }

  .toc-nav h3 {
    font-size: 1.125rem;
    font-weight: 700;
    margin-bottom: 1rem;
    color: #1a202c;
  }

  .toc-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .toc-list li {
    margin-bottom: 0.75rem;
  }

  .toc-link {
    color: #4a5568;
    text-decoration: none;
    font-size: 0.875rem;
    display: block;
    padding: 0.25rem 0;
    border-left: 2px solid transparent;
    padding-left: 0.75rem;
    transition: all 0.2s;
  }

  .toc-link:hover {
    color: #f97316;
    border-left-color: #f97316;
  }

  .toc-link.active {
    color: #f97316;
    font-weight: 600;
    border-left-color: #f97316;
  }

  /* FAQ Section */
  .service-faq {
    background: #f7fafc;
    padding: 4rem 0;
  }

  .service-faq h2 {
    text-align: center;
    font-size: 2.5rem;
    margin-bottom: 3rem;
    color: #1a202c;
  }

  .faq-grid {
    display: grid;
    gap: 1.5rem;
    max-width: 1000px;
    margin: 0 auto;
  }

  .faq-item {
    background: white;
    padding: 1.5rem;
    border-radius: 0.5rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }

  .faq-number {
    color: #f97316;
    font-weight: 700;
  }

  .faq-item h3 {
    color: #1a202c;
    margin-bottom: 1rem;
    font-size: 1.25rem;
  }

  .faq-item p {
    color: #4a5568;
    line-height: 1.7;
  }

  .more-questions {
    text-align: center;
    margin-top: 3rem;
  }

  .more-questions p {
    font-size: 1.25rem;
    margin-bottom: 1rem;
    color: #4a5568;
  }

  /* Related Services */
  .related-services {
    padding: 4rem 0;
  }

  .related-services h2 {
    text-align: center;
    font-size: 2.5rem;
    margin-bottom: 1rem;
    color: #1a202c;
  }

  .section-intro {
    text-align: center;
    font-size: 1.125rem;
    color: #4a5568;
    margin-bottom: 3rem;
  }

  .services-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
  }

  .service-card {
    background: #f7fafc;
    border-radius: 0.5rem;
    overflow: hidden;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    transition: transform 0.2s;
  }

  .service-card:hover {
    transform: translateY(-5px);
  }

  .service-card img {
    width: 100%;
    height: 200px;
    object-fit: cover;
  }

  .service-card h3 {
    padding: 1rem 1.5rem 0.5rem;
    color: #1a202c;
    font-size: 1.25rem;
  }

  .service-card p {
    padding: 0 1.5rem;
    color: #4a5568;
    line-height: 1.6;
  }

  .service-link {
    display: inline-block;
    padding: 0.5rem 1.5rem 1.5rem;
    color: #f97316;
    text-decoration: none;
    font-weight: 600;
  }

  .service-link:hover {
    text-decoration: underline;
  }

  /* Utility Classes */
  .w-full {
    width: 100%;
  }

  .btn {
    display: inline-block;
    padding: 0.75rem 1.5rem;
    border-radius: 0.375rem;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.2s;
    text-align: center;
  }

  .btn-primary {
    background-color: #f97316;
    color: white;
  }

  .btn-primary:hover {
    background-color: #ea580c;
  }

  .btn-outline {
    border: 2px solid white;
    color: white;
  }

  .btn-outline:hover {
    background-color: rgba(255, 255, 255, 0.1);
  }

  .btn-destructive {
    background-color: #dc2626;
    color: white;
  }

  .btn-destructive:hover {
    background-color: #b91c1c;
  }

  /* Mobile Responsive */
  @media (max-width: 768px) {
    .hero-title {
      font-size: 2rem;
    }
    
    .hero-description {
      font-size: 1rem;
    }
    
    .stat-value {
      font-size: 1.5rem;
    }
    
    .service-faq h2,
    .related-services h2 {
      font-size: 1.75rem;
    }

    .content-grid-three-column {
      grid-template-columns: 1fr;
    }

    /* Move sidebars to bottom on mobile */
    .sidebar-left {
      order: 1;
    }

    .sidebar-right {
      display: none;
    }
  }

  /* Smooth scroll for TOC links */
  html {
    scroll-behavior: smooth;
  }
</style>

<!-- Script for active TOC highlighting -->
<script>
  // Highlight active section in TOC
  document.addEventListener('DOMContentLoaded', () => {
    const tocLinks = document.querySelectorAll('.toc-link');
    const sections = document.querySelectorAll('.main-content h2, .main-content h3');
    
    if (tocLinks.length === 0 || sections.length === 0) return;

    const observerOptions = {
      rootMargin: '-20% 0px -70% 0px'
    };

    const observerCallback = (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          const id = entry.target.getAttribute('id');
          if (id) {
            tocLinks.forEach(link => {
              link.classList.remove('active');
              if (link.getAttribute('href') === `#${id}`) {
                link.classList.add('active');
              }
            });
          }
        }
      });
    };

    const observer = new IntersectionObserver(observerCallback, observerOptions);

    sections.forEach((section) => {
      if (section.getAttribute('id')) {
        observer.observe(section);
      }
    });
  });
</script>