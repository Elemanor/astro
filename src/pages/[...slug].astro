---
import { getCollection } from 'astro:content';
import MainLayout from '../layouts/MainLayout.astro';

export async function getStaticPaths() {
  // Get all collections that might have root-level URLs
  const locations = await getCollection('locations');
  const guides = await getCollection('guides');
  const problems = await getCollection('problems');
  
  const allPages = [...locations, ...guides, ...problems];
  
  // Filter pages that have root-level URLs (not under a subdirectory)
  const rootPages = allPages.filter(page => {
    if (!page.data.url) return false;
    const url = page.data.url.replace(/^\//, '').replace(/\/$/, '');
    return !url.includes('/');
  });
  
  return rootPages.map(page => {
    const slug = page.data.url.replace(/^\//, '').replace(/\/$/, '');
    return {
      params: { slug },
      props: { page, collection: page.collection }
    };
  });
}

const { page, collection } = Astro.props;
const { Content } = await page.render();
---

<MainLayout title={page.data.seo_title || page.data.title} description={page.data.description}>
  <div class="container mx-auto px-4 py-12">
    <article class="max-w-4xl mx-auto">
      <header class="mb-12">
        <h1 class="text-4xl lg:text-5xl font-bold mb-4">{page.data.title}</h1>
        {page.data.subtitle && (
          <p class="text-xl text-gray-600">{page.data.subtitle}</p>
        )}
        {collection === 'locations' && page.data.service_areas && (
          <p class="text-lg text-gray-600 mt-4">
            Serving: {page.data.service_areas.join(', ')}
          </p>
        )}
      </header>
      
      <div class="prose prose-lg max-w-none">
        <Content />
      </div>
      
      {/* Location-specific CTA */}
      {collection === 'locations' && (
        <div class="mt-12 bg-blue-600 text-white rounded-lg p-8 text-center">
          <h2 class="text-3xl font-bold mb-4">Need Waterproofing in {page.data.location}?</h2>
          <p class="text-xl mb-6">Get a free consultation and quote today!</p>
          <a href="tel:4375450067" class="inline-flex items-center justify-center px-8 py-4 bg-white text-blue-600 font-bold rounded-lg hover:bg-gray-100 transition-colors">
            ðŸ“ž Call (437) 545-0067 Now
          </a>
        </div>
      )}
      
      {/* Generic CTA for other pages */}
      {collection !== 'locations' && (
        <div class="mt-12 bg-blue-600 text-white rounded-lg p-8 text-center">
          <h2 class="text-3xl font-bold mb-4">Need Professional Help?</h2>
          <p class="text-xl mb-6">Get expert advice and a free quote today!</p>
          <a href="tel:4375450067" class="inline-flex items-center justify-center px-8 py-4 bg-white text-blue-600 font-bold rounded-lg hover:bg-gray-100 transition-colors">
            ðŸ“ž Call (437) 545-0067 Now
          </a>
        </div>
      )}
    </article>
  </div>
</MainLayout>