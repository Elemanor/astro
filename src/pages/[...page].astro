---
import { getCollection } from 'astro:content';
import MainLayout from '../layouts/MainLayout.astro';
import Hero from '../components/ui/Hero.astro';
import Section from '../components/ui/Section.astro';
import AstroCard from '../components/ui/AstroCard.astro';
import Breadcrumbs from '../components/Breadcrumbs.astro';

export async function getStaticPaths() {
  const pages = await getCollection('pages');
  
  return pages.map(page => {
    // Use the file id as the slug
    const slug = page.id.replace('.md', '');
    
    return {
      params: { page: slug },
      props: { page }
    };
  });
}

const { page } = Astro.props;
const { Content } = await page.render();

// Extract hero data from frontmatter if available
const heroTitle = page.data.hero_title || page.data.title;
const heroSubtitle = page.data.hero_subtitle || page.data.subtitle;
const heroDescription = page.data.hero_description || page.data.description;
const heroBadge = page.data.hero_badge || page.data.badge;
---

<MainLayout title={page.data.seo_title || page.data.title} description={page.data.description}>
  <!-- Hero Section -->
  <Hero
    title={heroTitle}
    subtitle={heroSubtitle}
    description={heroDescription}
    badge={heroBadge}
    alignment="center"
    size="small"
  />
  
  <!-- Main Content -->
  <Section>
    <div class="container mx-auto px-4">
      <!-- Breadcrumbs -->
      <Breadcrumbs current={page.data.title} />
      
      <div class="max-w-4xl mx-auto mt-8">
        <AstroCard class="p-8 md:p-12">
          <article class="prose prose-lg max-w-none
            prose-headings:font-bold prose-headings:text-foreground
            prose-p:text-foreground prose-p:leading-relaxed
            prose-a:text-primary prose-a:underline-offset-4 hover:prose-a:underline
            prose-strong:text-foreground prose-strong:font-semibold
            prose-ul:list-disc prose-ul:pl-6
            prose-ol:list-decimal prose-ol:pl-6
            prose-blockquote:border-l-4 prose-blockquote:border-primary prose-blockquote:pl-4 prose-blockquote:italic
            prose-img:rounded-lg prose-img:shadow-lg
            prose-code:bg-muted prose-code:px-1.5 prose-code:py-0.5 prose-code:rounded prose-code:text-sm
            prose-pre:bg-muted prose-pre:p-4 prose-pre:rounded-lg
            prose-table:border-collapse prose-table:w-full
            prose-th:border prose-th:border-border prose-th:px-4 prose-th:py-2 prose-th:bg-muted prose-th:font-semibold
            prose-td:border prose-td:border-border prose-td:px-4 prose-td:py-2
          ">
            <Content />
          </article>
        </AstroCard>
      </div>
    </div>
  </Section>
</MainLayout>