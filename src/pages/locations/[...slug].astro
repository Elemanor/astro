---
import { getCollection } from 'astro:content';
import LocationPageTemplate from '../../templates/LocationPageTemplate.astro';

export async function getStaticPaths() {
  const locations = await getCollection('locations');
  
  return locations.map(location => {
    // Handle the slug - if the location has a url in frontmatter, use it
    // Otherwise use the file id
    const slug = location.data.url 
      ? location.data.url.replace('/locations/', '').replace(/^\//,'').replace(/\/$/, '')
      : location.id;
    
    return {
      params: { slug },
      props: { location }
    };
  });
}

const { location } = Astro.props;
const { Content } = await location.render();

// Extract location data
const locationName = location.data.title || "Location";
const locationTitle = location.data.meta_title || location.data.title;
const locationSubtitle = location.data.subtitle || "Professional Waterproofing Services";
const locationDescription = location.data.description || "";

// Service areas (neighborhoods)
const serviceAreas = location.data.service_areas || location.data.neighborhoods || [];

// Services offered at this location
const servicesOffered = location.data.services || [
  {
    title: "Basement Waterproofing",
    description: "Complete interior and exterior waterproofing solutions",
    url: "/services/basement-waterproofing/"
  },
  {
    title: "Foundation Repair",
    description: "Expert foundation crack repair and reinforcement",
    url: "/services/foundation-repair/"
  },
  {
    title: "Sump Pump Installation",
    description: "Professional sump pump systems with battery backup",
    url: "/services/sump-pump-installation/"
  }
];

// Local stats
const localStats = location.data.stats || location.data.local_stats;
---

<LocationPageTemplate
  locationName={locationName}
  locationTitle={locationTitle}
  locationSubtitle={locationSubtitle}
  locationDescription={locationDescription}
  heroBadge={location.data.badge}
  heroImage={location.data.hero_image}
  serviceAreas={serviceAreas}
  servicesOffered={servicesOffered}
  localStats={localStats}
>
  <Content />
</LocationPageTemplate>