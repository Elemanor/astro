---
import { getCollection } from 'astro:content';
import MainLayout from '../../layouts/MainLayout.astro';
import Breadcrumbs from '../../components/Breadcrumbs.astro';
import RelatedContent from '../../components/RelatedContent.astro';

export async function getStaticPaths() {
  const blogPosts = await getCollection('blog');
  
  return blogPosts.map(post => {
    // Handle the slug - if the post has a url in frontmatter, use it
    // Otherwise use the file id
    const slug = post.data.url 
      ? post.data.url.replace('/blog/', '').replace(/\/$/, '')
      : post.id;
    
    return {
      params: { slug },
      props: { post }
    };
  });
}

const { post } = Astro.props;
const { Content } = await post.render();

// Get all posts for navigation
const allPosts = await getCollection('blog');

// Organize posts by category
const postsByCategory = allPosts.reduce((acc, p) => {
  const categories = p.data.categories || ['Uncategorized'];
  categories.forEach(cat => {
    if (!acc[cat]) acc[cat] = [];
    acc[cat].push({
      title: p.data.title,
      url: p.data.url || `/blog/${p.id}/`,
      isCurrent: p.id === post.id
    });
  });
  return acc;
}, {});

// Get related posts
const relatedPosts = allPosts
  .filter(p => p.id !== post.id)
  .filter(p => {
    // Find posts with similar categories
    const currentCategories = post.data.categories || [];
    const postCategories = p.data.categories || [];
    return currentCategories.some(cat => postCategories.includes(cat));
  })
  .slice(0, 5)
  .map(p => ({
    href: p.data.url || `/blog/${p.id}/`,
    title: p.data.title,
    description: p.data.description,
    type: 'blog'
  }));

// Get services and guides for cross-linking
const services = await getCollection('services');
const guides = await getCollection('guides');

// Find related content based on keywords
const keywords = (post.data.tags || []).concat(post.data.categories || []);
const relatedServices = services
  .filter(s => {
    const serviceTags = s.data.tags || [];
    return keywords.some(k => 
      s.data.title.toLowerCase().includes(k.toLowerCase()) ||
      serviceTags.some(t => t.toLowerCase().includes(k.toLowerCase()))
    );
  })
  .slice(0, 3)
  .map(s => ({
    title: s.data.title,
    url: s.data.url || `/services/${s.id}/`,
    type: 'service'
  }));

const relatedGuides = guides
  .filter(g => {
    const guideTags = g.data.tags || [];
    return keywords.some(k => 
      g.data.title.toLowerCase().includes(k.toLowerCase()) ||
      guideTags.some(t => t.toLowerCase().includes(k.toLowerCase()))
    );
  })
  .slice(0, 3)
  .map(g => ({
    title: g.data.title,
    url: g.data.url || `/guides/${g.id}/`,
    type: 'guide'
  }));
---

<MainLayout title={post.data.title} description={post.data.description}>
  <!-- Skip to main content link for keyboard users -->
  <a href="#main-content" class="skip-link">Skip to main content</a>
  
  <div class="blog-container">
    <div class="container">
      <!-- Breadcrumbs -->
      <Breadcrumbs current={post.data.title} />
      
      <!-- 3-Column Layout -->
      <div class="content-layout">
        <!-- Left Sidebar - Blog Navigation -->
        <aside class="sidebar-left" aria-label="Blog navigation">
          <div class="sticky-sidebar">
            <h3 class="sidebar-title"><span aria-hidden="true">üìö</span> All Articles</h3>
            
            <!-- Category Navigation -->
            <nav class="category-nav" aria-label="Articles by category">
              {Object.entries(postsByCategory).map(([category, posts]) => (
                <div class="category-group">
                  <h4 class="category-title">{category}</h4>
                  <ul class="post-list">
                    {posts.slice(0, 5).map(p => (
                      <li class={p.isCurrent ? 'current' : ''}>
                        <a href={p.url} aria-current={p.isCurrent ? 'page' : undefined}>
                          {p.isCurrent && <span class="current-indicator" aria-hidden="true">‚Üí</span>}
                          {p.title}
                        </a>
                      </li>
                    ))}
                  </ul>
                </div>
              ))}
            </nav>
            
            <!-- Quick Links -->
            <nav class="quick-links" aria-label="Quick navigation">
              <h4>Quick Links</h4>
              <ul>
                <li><a href="/services/">All Services</a></li>
                <li><a href="/guides/">DIY Guides</a></li>
                <li><a href="/contact/">Get Quote</a></li>
              </ul>
            </nav>
          </div>
        </aside>
        
        <!-- Main Content -->
        <main class="main-content" id="main-content">
          <!-- Article Header -->
          <header class="article-header">
            <h1 class="article-title">{post.data.title}</h1>
            
            <div class="article-meta">
              {post.data.date && (
                <time datetime={post.data.date}>
                  <span aria-hidden="true">üìÖ</span>
                  <span class="sr-only">Published on</span>
                  {new Date(post.data.date).toLocaleDateString('en-CA', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                  })}
                </time>
              )}
              
              {post.data.categories && post.data.categories.length > 0 && (
                <div class="categories">
                  {post.data.categories.map(cat => (
                    <span class="category-tag">{cat}</span>
                  ))}
                </div>
              )}
            </div>
          </header>
          
          <!-- Table of Contents (mobile/tablet) -->
          <nav class="toc-mobile" id="table-of-contents-mobile" aria-label="Table of contents">
            <details>
              <summary><span aria-hidden="true">üìë</span> Table of Contents</summary>
              <div class="toc-content" id="toc-list-mobile">
                <!-- Will be populated by JavaScript -->
              </div>
            </details>
          </nav>
          
          <!-- Article Content -->
          <article class="article-content">
            <Content />
          </article>
          
          <!-- Call to Action -->
          <div class="article-cta">
            <h3>Need Professional Help?</h3>
            <p>While our guides provide valuable information, some issues require professional expertise.</p>
            <div class="cta-buttons">
              <a href="tel:437-545-0067" class="cta-primary">
                <span aria-hidden="true">üìû</span> Call (437) 545-0067
              </a>
              <a href="/contact/" class="cta-secondary">
                Get Free Quote
              </a>
            </div>
          </div>
          
          <!-- Related Articles -->
          {relatedPosts.length > 0 && (
            <RelatedContent 
              title="Related Articles"
              items={relatedPosts.slice(0, 3)}
              layout="grid"
            />
          )}
        </main>
        
        <!-- Right Sidebar - Context & Related Content -->
        <aside class="sidebar-right" aria-label="Article context and related content">
          <div class="sticky-sidebar">
            <!-- Table of Contents (desktop) -->
            <nav class="toc-desktop" id="table-of-contents" aria-label="In this article">
              <h3><span aria-hidden="true">üìã</span> In This Article</h3>
              <div class="toc-content" id="toc-list">
                <!-- Will be populated by JavaScript -->
              </div>
            </nav>
            
            <!-- Key Points -->
            <section class="key-points" id="key-points" aria-live="polite" aria-label="Key points for current section">
              <h3><span aria-hidden="true">üîë</span> Key Points</h3>
              <div class="points-content" id="points-list">
                <!-- Will be populated by JavaScript based on current section -->
              </div>
            </section>
            
            <!-- Related Services -->
            {relatedServices.length > 0 && (
              <nav class="related-links" aria-label="Related services">
                <h3><span aria-hidden="true">üõ†Ô∏è</span> Related Services</h3>
                <ul>
                  {relatedServices.map(service => (
                    <li>
                      <a href={service.url}>{service.title}</a>
                    </li>
                  ))}
                </ul>
              </nav>
            )}
            
            <!-- Related Guides -->
            {relatedGuides.length > 0 && (
              <nav class="related-links" aria-label="Related guides">
                <h3><span aria-hidden="true">üìñ</span> Related Guides</h3>
                <ul>
                  {relatedGuides.map(guide => (
                    <li>
                      <a href={guide.url}>{guide.title}</a>
                    </li>
                  ))}
                </ul>
              </nav>
            )}
            
            <!-- Quick Contact -->
            <div class="quick-contact">
              <h3>Get Expert Help</h3>
              <p>Questions about this topic?</p>
              <a href="tel:437-545-0067" class="contact-btn">
                <span aria-hidden="true">üìû</span>
                <span class="sr-only">Call us at</span>
                (437) 545-0067
              </a>
              <a href="/contact/" class="quote-btn">
                Get Free Quote
              </a>
            </div>
          </div>
        </aside>
      </div>
    </div>
  </div>
  
  <script>
    // Generate table of contents and extract key points
    document.addEventListener('DOMContentLoaded', () => {
      const content = document.querySelector('.article-content');
      const tocList = document.getElementById('toc-list');
      const tocListMobile = document.getElementById('toc-list-mobile');
      const pointsList = document.getElementById('points-list');
      
      if (content) {
        const headings = content.querySelectorAll('h2');
        const sections = [];
        
        // Process headings and extract content
        headings.forEach((heading, index) => {
          // Add ID if missing
          if (!heading.id) {
            heading.id = `section-${index + 1}`;
          }
          
          // Get content until next heading
          let nextElement = heading.nextElementSibling;
          let sectionContent = [];
          let keyPoints = [];
          let importantNumbers = [];
          let warnings = [];
          
          while (nextElement && nextElement.tagName !== 'H2') {
            // Collect paragraph text
            if (nextElement.tagName === 'P') {
              const text = nextElement.textContent;
              sectionContent.push(text);
              
              // Extract numbers with context (e.g., "25+ years", "$500-$1000")
              const numberMatches = text.match(/\d+[\d,]*\+?\s*(?:years?|days?|hours?|%|dollars?|\$)/gi);
              if (numberMatches) {
                importantNumbers = importantNumbers.concat(numberMatches);
              }
              
              // Extract warnings or important notes
              if (text.toLowerCase().includes('warning') || 
                  text.toLowerCase().includes('important') || 
                  text.toLowerCase().includes('critical')) {
                warnings.push(text.substring(0, 100) + '...');
              }
            }
            
            // Extract lists as key points
            if (nextElement.tagName === 'UL' || nextElement.tagName === 'OL') {
              const items = nextElement.querySelectorAll('li');
              items.forEach((item, idx) => {
                if (idx < 5) { // Limit to first 5 items
                  keyPoints.push({
                    text: item.textContent.trim(),
                    type: 'list'
                  });
                }
              });
            }
            
            // Extract strong/bold text as key points
            if (nextElement.tagName === 'P') {
              const strongs = nextElement.querySelectorAll('strong, b');
              strongs.forEach(strong => {
                const text = strong.textContent.trim();
                if (text.length > 10 && text.length < 100) {
                  keyPoints.push({
                    text: text,
                    type: 'emphasis'
                  });
                }
              });
            }
            
            // Extract H3 headings as sub-points
            if (nextElement.tagName === 'H3') {
              keyPoints.push({
                text: nextElement.textContent,
                type: 'subheading'
              });
            }
            
            // Extract blockquotes
            if (nextElement.tagName === 'BLOCKQUOTE') {
              keyPoints.push({
                text: nextElement.textContent.trim(),
                type: 'quote'
              });
            }
            
            nextElement = nextElement.nextElementSibling;
          }
          
          const sectionData = {
            id: heading.id,
            title: heading.textContent,
            content: sectionContent.join(' '),
            keyPoints: keyPoints.slice(0, 5),
            importantNumbers: importantNumbers.slice(0, 3),
            warnings: warnings.slice(0, 1)
          };
          
          console.log('Section data:', sectionData); // Debug
          sections.push(sectionData);
        });
        
        // Generate TOC
        if (sections.length > 0 && tocList) {
          const ul = document.createElement('ul');
          
          sections.forEach(section => {
            const li = document.createElement('li');
            const a = document.createElement('a');
            a.href = `#${section.id}`;
            a.textContent = section.title;
            a.dataset.sectionId = section.id;
            a.addEventListener('click', (e) => {
              e.preventDefault();
              document.getElementById(section.id).scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
              });
            });
            
            li.appendChild(a);
            ul.appendChild(li);
          });
          
          tocList.appendChild(ul);
          
          // Clone for mobile
          if (tocListMobile) {
            tocListMobile.appendChild(ul.cloneNode(true));
          }
        }
        
        // Scroll tracking and key points update
        let currentSection = null;
        
        const updateActiveSection = () => {
          const scrollPosition = window.scrollY + 100;
          
          sections.forEach(section => {
            const element = document.getElementById(section.id);
            if (element) {
              const rect = element.getBoundingClientRect();
              const top = rect.top + window.scrollY;
              const bottom = top + rect.height;
              
              if (scrollPosition >= top && scrollPosition < bottom) {
                if (currentSection !== section.id) {
                  currentSection = section.id;
                  
                  // Update active TOC item
                  document.querySelectorAll('.toc-content a').forEach(a => {
                    a.classList.remove('active');
                    if (a.dataset.sectionId === section.id) {
                      a.classList.add('active');
                    }
                  });
                  
                  // Update key points display
                  updateKeyPointsDisplay(section);
                }
              }
            }
          });
        };
        
        // Initial update - show first section's key points
        if (sections.length > 0 && pointsList) {
          // Display first section's content immediately
          const firstSection = sections[0];
          currentSection = firstSection.id;
          
          // Update TOC
          document.querySelector(`.toc-content a[data-section-id="${firstSection.id}"]`)?.classList.add('active');
          
          // Display initial key points
          updateKeyPointsDisplay(firstSection);
        }
        
        function updateKeyPointsDisplay(section) {
          if (!pointsList) return;
          
          pointsList.innerHTML = '';
          
          // Show warnings first if any
          if (section.warnings && section.warnings.length > 0) {
            const warningDiv = document.createElement('div');
            warningDiv.className = 'warning-highlight';
            warningDiv.innerHTML = `<span aria-hidden="true">‚ö†Ô∏è</span> <span role="alert">${section.warnings[0]}</span>`;
            pointsList.appendChild(warningDiv);
          }
          
          // Show important numbers
          if (section.importantNumbers && section.importantNumbers.length > 0) {
            const numbersDiv = document.createElement('div');
            numbersDiv.className = 'numbers-highlight';
            section.importantNumbers.forEach(num => {
              const span = document.createElement('span');
              span.className = 'number-badge';
              span.textContent = num;
              numbersDiv.appendChild(span);
            });
            pointsList.appendChild(numbersDiv);
          }
          
          // Show key points with different styling based on type
          if (section.keyPoints && section.keyPoints.length > 0) {
            const pointsContainer = document.createElement('div');
            pointsContainer.className = 'points-container';
            
            section.keyPoints.forEach(point => {
              const pointDiv = document.createElement('div');
              pointDiv.className = `key-point key-point-${point.type || 'default'}`;
              
              if (typeof point === 'string') {
                // Handle legacy string format
                pointDiv.innerHTML = `<span>‚Ä¢ ${point}</span>`;
              } else {
                // Handle object format
                switch(point.type) {
                  case 'subheading':
                    pointDiv.innerHTML = `<strong><span aria-hidden="true">üìå</span> ${point.text}</strong>`;
                    break;
                  case 'emphasis':
                    pointDiv.innerHTML = `<span class="emphasis"><span aria-hidden="true">üí°</span> ${point.text}</span>`;
                    break;
                  case 'quote':
                    pointDiv.innerHTML = `<blockquote>"${point.text}"</blockquote>`;
                    break;
                  case 'list':
                  default:
                    pointDiv.innerHTML = `<span>‚Ä¢ ${point.text}</span>`;
                    break;
                }
              }
              
              pointsContainer.appendChild(pointDiv);
            });
            
            pointsList.appendChild(pointsContainer);
          } else if (!section.warnings || section.warnings.length === 0) {
            // Show summary if no key points or warnings
            const p = document.createElement('p');
            p.textContent = section.content.substring(0, 150) + '...';
            p.className = 'summary';
            pointsList.appendChild(p);
          }
        }
        
        // Update on scroll
        let scrollTimer;
        window.addEventListener('scroll', () => {
          clearTimeout(scrollTimer);
          scrollTimer = setTimeout(() => {
            updateActiveSection();
            
            // Find current section and update display
            const currentSectionData = sections.find(s => s.id === currentSection);
            if (currentSectionData) {
              updateKeyPointsDisplay(currentSectionData);
            }
          }, 50);
        });
      }
    });
  </script>
</MainLayout>

<style>
  /* Skip link for keyboard navigation */
  .skip-link {
    position: absolute;
    top: -40px;
    left: 0;
    background: #f97316;
    color: white;
    padding: 0.5rem 1rem;
    text-decoration: none;
    border-radius: 0 0 0.375rem 0;
    z-index: 100;
    font-weight: 600;
  }
  
  .skip-link:focus {
    top: 0;
  }
  
  /* Screen reader only text */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
  }
  
  /* Focus indicators */
  a:focus,
  button:focus,
  details summary:focus,
  [tabindex]:focus {
    outline: 3px solid #3b82f6;
    outline-offset: 2px;
  }
  
  /* High contrast mode support */
  @media (prefers-contrast: high) {
    .article-content a {
      text-decoration: underline;
    }
    
    .category-tag,
    .number-badge {
      border: 1px solid currentColor;
    }
  }
  
  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
      scroll-behavior: auto !important;
    }
  }
  
  .blog-container {
    padding: 2rem 0 4rem;
    background: #ffffff;
    min-height: 100vh;
  }
  
  .container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 1rem;
  }
  
  /* 3-Column Layout */
  .content-layout {
    display: grid;
    grid-template-columns: 250px 1fr 300px;
    gap: 2rem;
    margin-top: 2rem;
  }
  
  @media (max-width: 1200px) {
    .content-layout {
      grid-template-columns: 1fr 300px;
    }
    
    .sidebar-left {
      display: none;
    }
  }
  
  @media (max-width: 768px) {
    .content-layout {
      grid-template-columns: 1fr;
    }
    
    .sidebar-right {
      display: none;
    }
  }
  
  /* Sticky Sidebars */
  .sticky-sidebar {
    position: sticky;
    top: 2rem;
    max-height: calc(100vh - 4rem);
    overflow-y: auto;
  }
  
  /* Left Sidebar Styles */
  .sidebar-left {
    font-size: 0.875rem;
    background: linear-gradient(to bottom, #fafbfc 0%, #f7f9fb 100%);
    padding: 1.5rem;
    border-radius: 0.75rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
  }
  
  .sidebar-title {
    font-size: 1.125rem;
    font-weight: 700;
    margin-bottom: 1rem;
    color: #1a202c;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid transparent;
    background: linear-gradient(to right, #f97316, #fb923c) bottom / 100% 2px no-repeat;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  
  .category-nav {
    margin-bottom: 2rem;
  }
  
  .category-group {
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid #e5e7eb;
  }
  
  .category-group:last-child {
    border-bottom: none;
  }
  
  .category-title {
    font-size: 0.75rem;
    font-weight: 700;
    color: #9ca3af;
    margin-bottom: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  
  .category-title::before {
    content: '‚ñ∏';
    color: #f97316;
    font-size: 0.875rem;
    aria-hidden: true;
  }
  
  .post-list {
    list-style: none;
    padding: 0;
  }
  
  .post-list li {
    margin-bottom: 0.625rem;
    position: relative;
  }
  
  .post-list a {
    color: #6b7280;
    text-decoration: none;
    display: block;
    padding: 0.5rem 0.75rem;
    padding-left: 1.25rem;
    transition: all 0.2s;
    border-radius: 0.375rem;
    font-size: 0.875rem;
    line-height: 1.4;
  }
  
  .post-list a:hover {
    color: #f97316;
    background: rgba(249, 115, 22, 0.05);
    padding-left: 1.5rem;
  }
  
  .post-list li.current a {
    color: #f97316;
    font-weight: 600;
    background: rgba(249, 115, 22, 0.08);
  }
  
  .current-indicator {
    position: absolute;
    left: 0.5rem;
    top: 50%;
    transform: translateY(-50%);
    color: #f97316;
    font-weight: 700;
  }
  
  /* Add read indicators */
  .post-list a::after {
    content: '';
    position: absolute;
    left: 0.375rem;
    top: 50%;
    transform: translateY(-50%);
    width: 4px;
    height: 4px;
    background: #d1d5db;
    border-radius: 50%;
    opacity: 0.5;
  }
  
  .post-list li.current a::after {
    display: none;
  }
  
  .quick-links {
    padding: 1rem;
    margin-top: 1.5rem;
    background: rgba(249, 115, 22, 0.05);
    border-radius: 0.5rem;
    border: 1px solid rgba(249, 115, 22, 0.1);
  }
  
  .quick-links h4 {
    font-size: 0.75rem;
    font-weight: 700;
    margin-bottom: 0.75rem;
    color: #ea580c;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  
  .quick-links h4::before {
    content: '‚ö°';
    font-size: 0.875rem;
  }
  
  .quick-links ul {
    list-style: none;
    padding: 0;
  }
  
  .quick-links li {
    margin-bottom: 0.5rem;
  }
  
  .quick-links a {
    color: #ea580c;
    text-decoration: none;
    font-weight: 500;
    display: block;
    padding: 0.375rem 0.75rem;
    background: white;
    border-radius: 0.25rem;
    transition: all 0.2s;
    font-size: 0.875rem;
  }
  
  .quick-links a:hover {
    background: #fff7ed;
    transform: translateX(4px);
  }
  
  /* Main Content */
  .main-content {
    min-width: 0; /* Prevent overflow */
  }
  
  .article-header {
    margin-bottom: 3rem;
  }
  
  .article-title {
    font-size: 2.5rem;
    font-weight: 700;
    line-height: 1.2;
    margin-bottom: 1rem;
    color: #1a202c;
  }
  
  @media (min-width: 768px) {
    .article-title {
      font-size: 3rem;
    }
  }
  
  .article-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    align-items: center;
    color: #718096;
    font-size: 0.875rem;
  }
  
  .categories {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
  }
  
  .category-tag {
    background: #e2e8f0;
    color: #2d3748;
    padding: 0.25rem 0.75rem;
    border-radius: 0.25rem;
    font-size: 0.75rem;
    font-weight: 500;
  }
  
  /* Mobile TOC */
  .toc-mobile {
    display: none;
    margin-bottom: 2rem;
    background: linear-gradient(to bottom, #fafbfc 0%, #f7f9fb 100%);
    border-radius: 0.75rem;
    padding: 1rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
  }
  
  @media (max-width: 768px) {
    .toc-mobile {
      display: block;
    }
  }
  
  .toc-mobile summary {
    cursor: pointer;
    font-weight: 700;
    color: #1a202c;
    font-size: 1.125rem;
    padding-bottom: 0.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  
  .toc-mobile[open] summary::after {
    content: '‚Üë';
    margin-left: auto;
    color: #3b82f6;
  }
  
  .toc-mobile:not([open]) summary::after {
    content: '‚Üì';
    margin-left: auto;
    color: #6b7280;
  }
  
  .toc-mobile .toc-content {
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 2px solid transparent;
    background: linear-gradient(to right, #3b82f6, #60a5fa) top / 100% 2px no-repeat;
  }
  
  /* Article Content Styling */
  .article-content {
    font-size: 1.125rem;
    line-height: 1.8;
    color: #374151;
    font-family: Georgia, 'Times New Roman', serif;
    letter-spacing: -0.003em;
  }
  
  @media (min-width: 768px) {
    .article-content {
      font-size: 1.1875rem;
    }
  }
  
  /* Typography */
  .article-content h1,
  .article-content h2,
  .article-content h3,
  .article-content h4,
  .article-content h5,
  .article-content h6 {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    font-weight: 700;
    line-height: 1.3;
    margin-top: 2.5rem;
    margin-bottom: 1rem;
    color: #111827;
    letter-spacing: -0.02em;
  }
  
  .article-content h2 {
    font-size: 2rem;
    margin-top: 3.5rem;
    padding-top: 1.5rem;
    position: relative;
  }
  
  @media (min-width: 768px) {
    .article-content h2 {
      font-size: 2.25rem;
    }
  }
  
  .article-content h2::before {
    content: '';
    position: absolute;
    left: -2rem;
    top: 50%;
    transform: translateY(-50%);
    width: 4px;
    height: 2rem;
    background: linear-gradient(to bottom, #f97316, #fb923c);
    border-radius: 2px;
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  
  @media (min-width: 1024px) {
    .article-content h2::before {
      opacity: 1;
    }
  }
  
  .article-content h3 {
    font-size: 1.625rem;
    margin-top: 2rem;
    color: #374151;
  }
  
  .article-content p {
    margin-bottom: 1.75rem;
  }
  
  /* Drop cap for first paragraph */
  .article-content > p:first-of-type:first-letter {
    float: left;
    font-size: 4.5rem;
    line-height: 0.8;
    margin: 0.125rem 0.5rem 0 0;
    font-weight: 700;
    color: #f97316;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  }
  
  .article-content ul,
  .article-content ol {
    margin: 1.75rem 0;
    padding-left: 1.5rem;
  }
  
  .article-content ul {
    list-style: none;
  }
  
  .article-content ul li {
    position: relative;
    padding-left: 1.5rem;
    margin-bottom: 0.75rem;
  }
  
  .article-content ul li::before {
    content: '‚Üí';
    position: absolute;
    left: 0;
    color: #f97316;
    font-weight: 700;
  }
  
  .article-content ol {
    counter-reset: article-counter;
    list-style: none;
  }
  
  .article-content ol li {
    position: relative;
    padding-left: 2rem;
    margin-bottom: 0.75rem;
    counter-increment: article-counter;
  }
  
  .article-content ol li::before {
    content: counter(article-counter);
    position: absolute;
    left: 0;
    top: 0.125rem;
    width: 1.5rem;
    height: 1.5rem;
    background: #f97316;
    color: white;
    border-radius: 50%;
    font-size: 0.75rem;
    font-weight: 700;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .article-content strong {
    font-weight: 700;
    color: #111827;
    background: linear-gradient(to bottom, transparent 60%, #fed7aa 60%);
    padding: 0 2px;
  }
  
  .article-content a {
    color: #f97316;
    text-decoration: none;
    position: relative;
    transition: color 0.2s ease;
    font-weight: 500;
  }
  
  .article-content a::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    right: 0;
    height: 2px;
    background: #f97316;
    transform: scaleX(0);
    transform-origin: right;
    transition: transform 0.3s ease;
  }
  
  .article-content a:hover {
    color: #ea580c;
  }
  
  .article-content a:hover::after {
    transform: scaleX(1);
    transform-origin: left;
  }
  
  /* Image Styling */
  .article-content img {
    width: 100%;
    height: auto;
    border-radius: 0.5rem;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    margin: 2rem 0;
  }
  
  .article-content figure {
    margin: 2rem 0;
    border-radius: 0.5rem;
    overflow: hidden;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }
  
  .article-content figure img {
    margin: 0;
    display: block;
    box-shadow: none;
  }
  
  .article-content figcaption {
    background-color: #f7fafc;
    padding: 0.75rem;
    text-align: center;
    font-size: 0.875rem;
    color: #4a5568;
    font-style: italic;
  }
  
  /* Tables */
  .article-content table {
    width: 100%;
    border-collapse: collapse;
    margin: 2rem 0;
    font-size: 0.875rem;
  }
  
  .article-content th,
  .article-content td {
    border: 1px solid #e2e8f0;
    padding: 0.75rem;
    text-align: left;
  }
  
  .article-content th {
    background: #f7fafc;
    font-weight: 600;
  }
  
  .article-content tr:nth-child(even) {
    background: #f7fafc;
  }
  
  /* Blockquotes */
  .article-content blockquote {
    position: relative;
    margin: 2.5rem 0;
    padding: 1.5rem 2rem;
    background: linear-gradient(135deg, #f8fafc 0%, #e5e7eb 100%);
    border-left: 4px solid #f97316;
    border-radius: 0.5rem;
    font-style: italic;
    color: #374151;
    font-size: 1.125rem;
    quotes: """ """ "'" "'";
  }
  
  .article-content blockquote::before {
    content: open-quote;
    position: absolute;
    top: -0.5rem;
    left: 1rem;
    font-size: 4rem;
    color: #f97316;
    opacity: 0.3;
    font-family: Georgia, serif;
  }
  
  .article-content blockquote p:last-child {
    margin-bottom: 0;
  }
  
  /* Code */
  .article-content code {
    background: #f7fafc;
    padding: 0.125rem 0.25rem;
    border-radius: 0.25rem;
    font-size: 0.875em;
    font-family: monospace;
  }
  
  .article-content pre {
    background: #1a202c;
    color: #f7fafc;
    padding: 1rem;
    border-radius: 0.5rem;
    overflow-x: auto;
    margin: 2rem 0;
  }
  
  .article-content pre code {
    background: none;
    padding: 0;
    color: inherit;
  }
  
  /* Call to Action */
  .article-cta {
    margin: 4rem 0;
    padding: 2rem;
    background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
    border-radius: 0.5rem;
    text-align: center;
    border: 1px solid #bbf7d0;
  }
  
  .article-cta h3 {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
    color: #166534;
  }
  
  .article-cta p {
    margin-bottom: 1.5rem;
    color: #15803d;
  }
  
  .cta-buttons {
    display: flex;
    gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
  }
  
  .cta-primary,
  .cta-secondary {
    padding: 0.75rem 1.5rem;
    border-radius: 0.375rem;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.2s;
  }
  
  .cta-primary {
    background: #f97316;
    color: white;
  }
  
  .cta-primary:hover {
    background: #ea580c;
    transform: translateY(-1px);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }
  
  .cta-secondary {
    background: white;
    color: #166534;
    border: 2px solid #166534;
  }
  
  .cta-secondary:hover {
    background: #f0fdf4;
  }
  
  /* Callout Boxes */
  .article-content .callout {
    padding: 1rem;
    border-radius: 0.5rem;
    margin: 2rem 0;
  }
  
  .article-content .callout-info {
    background: #eff6ff;
    border-left: 4px solid #3b82f6;
    color: #1e40af;
  }
  
  .article-content .callout-warning {
    background: #fef3c7;
    border-left: 4px solid #f59e0b;
    color: #92400e;
  }
  
  .article-content .callout-success {
    background: #f0fdf4;
    border-left: 4px solid #10b981;
    color: #166534;
  }
  
  /* Right Sidebar Styles */
  .sidebar-right {
    font-size: 0.875rem;
  }
  
  .sidebar-right > .sticky-sidebar > div {
    margin-bottom: 1.5rem;
    background: white;
    border-radius: 0.75rem;
    border: 1px solid #e2e8f0;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    transition: all 0.3s ease;
  }
  
  .sidebar-right > .sticky-sidebar > div:not(.toc-desktop) {
    padding: 1.5rem;
  }
  
  .sidebar-right > .sticky-sidebar > div:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    transform: translateY(-1px);
  }
  
  .sidebar-right h3 {
    font-size: 1rem;
    font-weight: 700;
    margin-bottom: 1rem;
    color: #1a202c;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  
  /* Desktop TOC - Styled like All Articles */
  .toc-desktop {
    display: block;
    background: linear-gradient(to bottom, #fafbfc 0%, #f7f9fb 100%) !important;
    border: none !important;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05) !important;
    padding: 1.5rem !important;
  }
  
  .toc-desktop h3 {
    font-size: 1.125rem !important;
    font-weight: 700;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid transparent;
    background: linear-gradient(to right, #3b82f6, #60a5fa) bottom / 100% 2px no-repeat;
    margin-bottom: 1rem;
    color: #1a202c;
  }
  
  @media (max-width: 768px) {
    .toc-desktop {
      display: none;
    }
  }
  
  .toc-content ul {
    list-style: none;
    padding: 0;
  }
  
  .toc-content li {
    margin-bottom: 0.625rem;
    position: relative;
  }
  
  .toc-content a {
    color: #6b7280;
    text-decoration: none;
    display: block;
    padding: 0.5rem 0.75rem;
    padding-left: 1.25rem;
    transition: all 0.2s;
    border-radius: 0.375rem;
    font-size: 0.875rem;
    line-height: 1.4;
    position: relative;
  }
  
  .toc-content a:hover {
    color: #3b82f6;
    background: rgba(59, 130, 246, 0.05);
    padding-left: 1.5rem;
  }
  
  .toc-content a.active {
    color: #3b82f6;
    font-weight: 600;
    background: rgba(59, 130, 246, 0.08);
  }
  
  .toc-content a.active::before {
    content: '‚Üí';
    position: absolute;
    left: 0.5rem;
    top: 50%;
    transform: translateY(-50%);
    color: #3b82f6;
    font-weight: 700;
  }
  
  /* Add dot indicators like post list */
  .toc-content a::after {
    content: '';
    position: absolute;
    left: 0.375rem;
    top: 50%;
    transform: translateY(-50%);
    width: 4px;
    height: 4px;
    background: #d1d5db;
    border-radius: 50%;
    opacity: 0.5;
  }
  
  .toc-content a.active::after {
    display: none;
  }
  
  
  /* Key Points Enhanced */
  .key-points {
    background: linear-gradient(135deg, #fffbf5 0%, #fff9f0 100%) !important;
  }
  
  .warning-highlight {
    background: #fef3c7;
    border-left: 3px solid #f59e0b;
    padding: 0.75rem;
    margin-bottom: 1rem;
    border-radius: 0.375rem;
    font-weight: 600;
    color: #92400e;
    animation: slideInRight 0.3s ease;
  }
  
  .numbers-highlight {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-bottom: 1rem;
  }
  
  .number-badge {
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    color: white;
    padding: 0.375rem 0.75rem;
    border-radius: 9999px;
    font-weight: 700;
    font-size: 0.875rem;
    box-shadow: 0 2px 4px rgba(59, 130, 246, 0.3);
    animation: popIn 0.3s ease;
  }
  
  .points-container {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }
  
  .key-point {
    padding: 0.75rem;
    border-radius: 0.5rem;
    line-height: 1.5;
    animation: fadeInUp 0.4s ease;
    transition: all 0.2s ease;
  }
  
  .key-point:hover {
    transform: translateX(4px);
  }
  
  .key-point-list {
    background: #f0f9ff;
    border-left: 3px solid #3b82f6;
    color: #1e40af;
  }
  
  .key-point-subheading {
    background: #f3f4f6;
    border-left: 3px solid #6b7280;
    font-weight: 700;
  }
  
  .key-point-emphasis {
    background: #fef3c7;
    border-left: 3px solid #fbbf24;
    color: #92400e;
  }
  
  .key-point-quote {
    background: #ede9fe;
    border-left: 3px solid #8b5cf6;
    font-style: italic;
    color: #5b21b6;
  }
  
  .key-point-quote blockquote {
    margin: 0;
    padding: 0;
  }
  
  .key-point-default {
    background: #f9fafb;
    border-left: 3px solid #d1d5db;
    color: #374151;
  }
  
  .key-points .summary {
    font-style: italic;
    color: #4a5568;
    line-height: 1.5;
    padding: 0.75rem;
    background: #f9fafb;
    border-radius: 0.375rem;
    border: 1px dashed #cbd5e0;
  }
  
  /* Article section separators */
  .article-content h2:not(:first-child) {
    position: relative;
  }
  
  .article-content h2:not(:first-child)::after {
    content: '‚Ä¢ ‚Ä¢ ‚Ä¢';
    display: block;
    text-align: center;
    margin: 2.5rem 0;
    color: #d1d5db;
    font-size: 1.5rem;
    letter-spacing: 1rem;
    font-weight: 400;
  }
  
  /* Animations */
  @keyframes slideInRight {
    from {
      transform: translateX(20px);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }
  
  @keyframes popIn {
    0% {
      transform: scale(0.8);
      opacity: 0;
    }
    50% {
      transform: scale(1.05);
    }
    100% {
      transform: scale(1);
      opacity: 1;
    }
  }
  
  @keyframes fadeInUp {
    from {
      transform: translateY(10px);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }
  
  /* Related Links */
  .related-links {
    background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%) !important;
  }
  
  .related-links ul {
    list-style: none;
    padding: 0;
  }
  
  .related-links li {
    margin-bottom: 0.75rem;
  }
  
  .related-links a {
    color: #059669;
    text-decoration: none;
    font-size: 0.875rem;
    display: block;
    padding: 0.5rem 0.75rem;
    background: rgba(255, 255, 255, 0.7);
    border-radius: 0.375rem;
    transition: all 0.2s;
    border: 1px solid transparent;
  }
  
  .related-links a:hover {
    background: white;
    border-color: #10b981;
    transform: translateX(4px);
    box-shadow: 0 2px 4px rgba(16, 185, 129, 0.1);
  }
  
  /* Quick Contact */
  .quick-contact {
    background: linear-gradient(135deg, #fff7ed 0%, #ffedd5 100%) !important;
    text-align: center;
  }
  
  .quick-contact p {
    margin-bottom: 1rem;
    color: #4a5568;
  }
  
  .contact-btn,
  .quote-btn {
    display: block;
    padding: 0.75rem 1rem;
    margin-bottom: 0.75rem;
    border-radius: 0.375rem;
    text-decoration: none;
    font-weight: 600;
    transition: all 0.2s;
  }
  
  .contact-btn {
    background: #f97316;
    color: white;
  }
  
  .contact-btn:hover {
    background: #ea580c;
    transform: translateY(-1px);
  }
  
  .quote-btn {
    background: white;
    color: #f97316;
    border: 2px solid #f97316;
  }
  
  .quote-btn:hover {
    background: #fff7ed;
  }
  
  /* Scrollbar Styling */
  .sticky-sidebar::-webkit-scrollbar {
    width: 6px;
  }
  
  .sticky-sidebar::-webkit-scrollbar-track {
    background: #f1f1f1;
  }
  
  .sticky-sidebar::-webkit-scrollbar-thumb {
    background: #cbd5e0;
    border-radius: 3px;
  }
  
  .sticky-sidebar::-webkit-scrollbar-thumb:hover {
    background: #a0aec0;
  }
</style>