---
import { getCollection } from 'astro:content';
import MainLayout from '../../layouts/MainLayout.astro';

export async function getStaticPaths() {
  const problems = await getCollection('problems');
  
  return problems.map(problem => {
    // Handle the slug - if the problem has a url in frontmatter, use it
    // Otherwise use the file id
    const slug = problem.data.url 
      ? problem.data.url.replace('/problems/', '').replace(/\/$/, '')
      : problem.id;
    
    return {
      params: { slug },
      props: { problem }
    };
  });
}

const { problem } = Astro.props;
const { Content } = await problem.render();
---

<MainLayout title={problem.data.seo_title || problem.data.title} description={problem.data.description}>
  <div class="container mx-auto px-4 py-12">
    <article class="max-w-4xl mx-auto">
      <header class="mb-12">
        <h1 class="text-4xl lg:text-5xl font-bold mb-4">{problem.data.title}</h1>
        {problem.data.subtitle && (
          <p class="text-xl text-gray-600">{problem.data.subtitle}</p>
        )}
        {problem.data.urgency === 'high' && (
          <div class="mt-4 bg-red-100 border-l-4 border-red-500 p-4 rounded">
            <p class="text-red-700 font-semibold">  This issue requires immediate attention</p>
          </div>
        )}
      </header>
      
      <div class="prose prose-lg max-w-none">
        <Content />
      </div>
      
      {/* Solutions Section */}
      {problem.data.solutions && (
        <div class="mt-12">
          <h2 class="text-2xl font-bold mb-6">Solutions for {problem.data.title}</h2>
          <div class="grid md:grid-cols-2 gap-6">
            {problem.data.solutions.map((solution: any) => (
              <div class="bg-gray-50 rounded-lg p-6">
                <h3 class="font-bold text-lg mb-2">{solution.title}</h3>
                <p class="text-gray-700 mb-4">{solution.description}</p>
                {solution.link && (
                  <a href={solution.link} class="text-blue-600 font-semibold hover:underline">
                    Learn more ’
                  </a>
                )}
              </div>
            ))}
          </div>
        </div>
      )}
      
      {/* CTA */}
      <div class="mt-12 bg-blue-600 text-white rounded-lg p-8 text-center">
        <h2 class="text-3xl font-bold mb-4">Need Help with {problem.data.title}?</h2>
        <p class="text-xl mb-6">Get expert diagnosis and solutions today!</p>
        <a href="tel:4375450067" class="inline-flex items-center justify-center px-8 py-4 bg-white text-blue-600 font-bold rounded-lg hover:bg-gray-100 transition-colors">
          =Þ Call (437) 545-0067 Now
        </a>
      </div>
    </article>
  </div>
</MainLayout>