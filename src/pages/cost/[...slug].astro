---
import { getCollection } from 'astro:content';
import MainLayout from '../../layouts/MainLayout.astro';
import Hero from '../../components/ui/Hero.astro';
import Section from '../../components/ui/Section.astro';
import AstroCard from '../../components/ui/AstroCard.astro';
import AstroButton from '../../components/ui/AstroButton.astro';
import Breadcrumbs from '../../components/Breadcrumbs.astro';
import { DollarSign, Calculator, Phone, ArrowRight } from 'lucide-react';

export async function getStaticPaths() {
  const costPages = await getCollection('cost');
  
  return costPages.map(page => {
    const slug = page.data.url 
      ? page.data.url.replace('/cost/', '').replace(/\/$/, '')
      : page.id;
    
    return {
      params: { slug },
      props: { page }
    };
  });
}

const { page } = Astro.props;
const { Content } = await page.render();

// Extract hero data from frontmatter if available
const heroTitle = page.data.hero_title || page.data.title;
const heroSubtitle = page.data.hero_subtitle || page.data.subtitle || "Transparent Pricing Information";
const heroDescription = page.data.hero_description || page.data.description;
const heroBadge = page.data.hero_badge || page.data.badge || "Cost Guide";
---

<MainLayout title={page.data.seo_title || page.data.title} description={page.data.description}>
  <!-- Hero Section -->
  <Hero
    title={heroTitle}
    subtitle={heroSubtitle}
    description={heroDescription}
    badge={heroBadge}
    alignment="center"
    size="small"
  />
  
  <!-- Main Content -->
  <Section>
    <div class="container mx-auto px-4">
      <!-- Breadcrumbs -->
      <Breadcrumbs current={page.data.title} />
      
      <div class="grid lg:grid-cols-[1fr_350px] gap-8 mt-8">
        <!-- Main Article -->
        <div>
          <AstroCard class="p-8 md:p-12">
            <article class="prose prose-lg max-w-none
              prose-headings:font-bold prose-headings:text-foreground
              prose-p:text-foreground prose-p:leading-relaxed
              prose-a:text-primary prose-a:underline-offset-4 hover:prose-a:underline
              prose-strong:text-foreground prose-strong:font-semibold
              prose-ul:list-disc prose-ul:pl-6
              prose-ol:list-decimal prose-ol:pl-6
              prose-blockquote:border-l-4 prose-blockquote:border-primary prose-blockquote:pl-4 prose-blockquote:italic
              prose-img:rounded-lg prose-img:shadow-lg
              prose-code:bg-muted prose-code:px-1.5 prose-code:py-0.5 prose-code:rounded prose-code:text-sm
              prose-pre:bg-muted prose-pre:p-4 prose-pre:rounded-lg
              prose-table:border-collapse prose-table:w-full
              prose-th:border prose-th:border-border prose-th:px-4 prose-th:py-2 prose-th:bg-muted prose-th:font-semibold
              prose-td:border prose-td:border-border prose-td:px-4 prose-td:py-2
            ">
              <Content />
            </article>
          </AstroCard>
        </div>
        
        <!-- Sidebar -->
        <aside class="space-y-6">
          <!-- Cost Calculator CTA -->
          <AstroCard class="bg-gradient-to-br from-primary/5 to-primary/10 border-primary/20">
            <div class="text-center space-y-4">
              <Calculator className="h-12 w-12 text-primary mx-auto" client:load />
              <h3 class="text-xl font-bold">Calculate Your Cost</h3>
              <p class="text-sm text-muted-foreground">
                Get an instant estimate for your waterproofing project
              </p>
              <AstroButton href="/tools/basement-waterproofing-calculator/" class="w-full">
                Use Cost Calculator
              </AstroButton>
            </div>
          </AstroCard>
          
          <!-- Get Quote CTA -->
          <AstroCard class="bg-gradient-to-br from-secondary/5 to-secondary/10 border-secondary/20">
            <div class="text-center space-y-4">
              <DollarSign className="h-12 w-12 text-secondary mx-auto" client:load />
              <h3 class="text-xl font-bold">Get Accurate Quote</h3>
              <p class="text-sm text-muted-foreground">
                Free inspection and detailed pricing for your specific needs
              </p>
              <AstroButton href="/contact/" variant="secondary" class="w-full">
                Request Free Quote
              </AstroButton>
            </div>
          </AstroCard>
          
          <!-- Emergency Service -->
          <AstroCard>
            <div class="text-center space-y-4">
              <h4 class="font-semibold">Need Immediate Help?</h4>
              <p class="text-sm text-muted-foreground">
                24/7 emergency waterproofing service
              </p>
              <AstroButton href="tel:437-545-0067" variant="outline" size="sm" class="w-full">
                <Phone className="h-4 w-4 mr-2" client:load />
                (437) 545-0067
              </AstroButton>
            </div>
          </AstroCard>
          
          <!-- Related Cost Guides -->
          <AstroCard>
            <h4 class="font-semibold mb-4">Related Cost Guides</h4>
            <ul class="space-y-2 text-sm">
              <li>
                <a href="/cost/basement-waterproofing-cost-toronto/" class="text-muted-foreground hover:text-primary transition-colors">
                  Basement Waterproofing Costs
                </a>
              </li>
              <li>
                <a href="/cost/foundation-repair-cost-toronto/" class="text-muted-foreground hover:text-primary transition-colors">
                  Foundation Repair Costs
                </a>
              </li>
              <li>
                <a href="/cost/sump-pump-installation-cost/" class="text-muted-foreground hover:text-primary transition-colors">
                  Sump Pump Installation Costs
                </a>
              </li>
              <li>
                <a href="/cost/french-drain-cost-toronto/" class="text-muted-foreground hover:text-primary transition-colors">
                  French Drain Costs
                </a>
              </li>
            </ul>
          </AstroCard>
        </aside>
      </div>
    </div>
  </Section>
  
  <!-- Bottom CTA -->
  <Section background="primary" spacing="small">
    <div class="text-center space-y-6">
      <h2 class="text-3xl font-bold text-white">Ready to Get Started?</h2>
      <p class="text-xl text-white/90 max-w-2xl mx-auto">
        Get a detailed quote for your specific waterproofing needs. No obligation, no hidden fees.
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <AstroButton 
          href="/contact/" 
          size="lg"
          class="bg-white text-primary hover:bg-gray-100"
        >
          Get Free Quote
          <ArrowRight className="h-5 w-5 ml-2" client:load />
        </AstroButton>
        <AstroButton 
          href="tel:437-545-0067" 
          variant="outline" 
          size="lg"
          class="border-white text-white hover:bg-white/10"
        >
          <Phone className="h-5 w-5 mr-2" client:load />
          Call for Pricing
        </AstroButton>
      </div>
    </div>
  </Section>
</MainLayout>